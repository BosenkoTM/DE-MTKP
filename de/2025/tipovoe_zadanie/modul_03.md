# Модуль № 3: Соадминистрирование баз данных и серверов

## Текст задания

### Задачи:
1. **Список клиентов с суммой к оплате**  
   Выведите список клиентов с указанием общей суммы к оплате, включая стоимость проживания и все дополнительные услуги.

2. **Обновление статуса номеров**  
   Измените статус всех номеров с `"Назначен к уборке"` на `"Чистый"`.

---

### Необходимые приложения:
- **Текст брифинга.pdf**
- **Документы заказчика.zip**

---

## Решение

### 1. Запрос списка клиентов с суммой к оплате
```sql
SELECT 
    g.FullName AS Клиент,
    b.BookingID AS Номер_бронирования,
    (SUM(p.Amount) + COALESCE(SUM(s.Price * bs.Quantity), 0)) AS Общая_сумма
FROM Guests g
JOIN Bookings b ON g.GuestID = b.GuestID
LEFT JOIN Payments p ON b.BookingID = p.BookingID
LEFT JOIN BookingServices bs ON b.BookingID = bs.BookingID
LEFT JOIN Services s ON bs.ServiceID = s.ServiceID
GROUP BY g.FullName, b.BookingID;
```

**Пояснение:**  
- **`LEFT JOIN`** используется для включения всех бронирований, даже без дополнительных услуг.
- **`COALESCE`** обрабатывает `NULL`-значения (если услуг нет).
- **Сумма включает:**  
  - Основную оплату за проживание (`Payments.Amount`).
  - Стоимость дополнительных услуг (`Services.Price * BookingServices.Quantity`).

---

### 2. Запрос на обновление статуса номеров
```sql
UPDATE Rooms
SET Status = 'Чистый'
WHERE Status = 'Назначен к уборке';
```

**Пояснение:**  
- Меняет статус номеров с `"Назначен к уборке"` на `"Чистый"`.
- Запрос выполняется для всех номеров, соответствующих условию.

---

### Пример данных после выполнения запросов

#### Таблица `Rooms` (после обновления):
| RoomID | Floor   | Status  |
|--------|---------|---------|
| 1      | 1 этаж  | Чистый  |
| 3      | 3 этаж  | Чистый  |

#### Результат первого запроса:
| Клиент                  | Номер_бронирования | Общая_сумма |
|-------------------------|--------------------|-------------|
| Шевченко Ольга Викторовна | 1                  | 62500.00    |
| Мазалова Ирина Львовна   | 2                  | 47800.00    |

---

### Примечания:
- Для корректной работы запросов убедитесь, что:
  - Таблицы `Bookings`, `Payments`, `Services`, `BookingServices` заполнены данными.
  - В таблице `Rooms` есть номера со статусом `"Назначен к уборке"`.
- Если сумма к оплате должна включать только оплаченные услуги, добавьте фильтр `WHERE p.Status = 'Оплачено'`.


Прикрепить электронный отчет №3, в котором отобразить:
- Скрипты согласно задачам модуля 3.

Продемонстрировать работу скриптов преподавателю.
